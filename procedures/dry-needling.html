<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />

  <title>Терапия със сухи игли — стъпка по стъпка | DM Physio</title>
  <meta name="description" content="Как протича терапията със сухи игли в DM Physio: функционална оценка, апликация със стерилни игли и индивидуални упражнения. Бързо намаляване на болката и по-добра подвижност." />
  <link rel="canonical" href="https://dmphysi0.com/procedures/details-dry-needling.html" />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
  <meta name="theme-color" content="#0E7C86" />
  <meta name="author" content="DM Physio" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />

  <!-- hreflang -->
  <link rel="alternate" hreflang="bg" href="https://dmphysi0.com/procedures/details-dry-needling.html" />
  <link rel="alternate" hreflang="x-default" href="https://dmphysi0.com/procedures/details-dry-needling.html" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/webp" href="/logo.webp" sizes="32x32">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">

  <!-- Open Graph -->
  <meta property="og:title" content="Терапия със сухи игли — стъпка по стъпка | DM Physio" />
  <meta property="og:description" content="Функционална оценка, сухо иглоубождане и персонализирани упражнения – ясна последователност за бързо облекчаване на болката и възстановяване." />
  <meta property="og:url" content="https://dmphysi0.com/procedures/details-dry-needling.html" />
  <meta property="og:type" content="article" />
  <meta property="og:locale" content="bg_BG" />
  <meta property="og:site_name" content="DM Physio" />
  <meta property="og:image" content="https://dmphysi0.com/og/dry-needling_1200x630.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="DM Physio – терапия със сухи игли в София" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Терапия със сухи игли — стъпка по стъпка | DM Physio" />
  <meta name="twitter:description" content="Оценка, сухо иглоубождане и упражнения — безопасно и ефективно облекчаване на болката." />
  <meta name="twitter:image" content="https://dmphysi0.com/og/dry-needling_1200x630.jpg" />

  <!-- Preconnect (карта) -->
  <link rel="preconnect" href="https://maps.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://maps.gstatic.com" crossorigin>

  <!-- CSS (без инлайн стилове, за да не влияе на сайдбара) -->
  <link rel="stylesheet" href="/css/top-bar.css">
  <link rel="stylesheet" href="../css/procedure.css">

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Начало","item":"https://dmphysi0.com/"},
      {"@type":"ListItem","position":2,"name":"Процедури","item":"https://dmphysi0.com/services.html"},
      {"@type":"ListItem","position":3,"name":"Терапия със сухи игли","item":"https://dmphysi0.com/procedures/details-dry-needling.html"}
    ]
  }
  </script>

  <!-- JSON-LD: Service -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Service",
    "name":"Терапия със сухи игли",
    "serviceType":"Physiotherapy",
    "provider":{"@type":"MedicalBusiness","name":"DM Physio","url":"https://dmphysi0.com/","telephone":"+359883688414"},
    "areaServed":{"@type":"City","name":"София"},
    "offers":{"@type":"Offer","priceCurrency":"BGN","price":"60","url":"https://dmphysi0.com/procedures/details-dry-needling.html","availability":"https://schema.org/InStock"},
    "url":"https://dmphysi0.com/procedures/details-dry-needling.html",
    "description":"Сухо иглоубождане за освобождаване на тригерни точки и редуциране на болка, включва функционална оценка и индивидуални упражнения."
  }
  </script>

  <!-- JSON-LD: FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"За кого е подходяща тази процедура?","acceptedAnswer":{"@type":"Answer","text":"Остра и хронична болка в гърба, врата, раменете, коленете и други стави; възстановяване след спортни травми и операции; мускулни дисбаланси и постурални нарушения; изтръпвания и други неврологични симптоми; главоболие от напрежение; намалена подвижност и скованост; превенция на травми."}},
      {"@type":"Question","name":"Колко често трябва да посещавам процедурата?","acceptedAnswer":{"@type":"Answer","text":"Обичайно започваме с 1–2 сесии седмично, след което честотата се намалява според напредъка и индивидуалния план."}},
      {"@type":"Question","name":"Необходима ли е подготовка?","acceptedAnswer":{"@type":"Answer","text":"Носете удобно облекло, което позволява свободно движение, и споделете предишни травми, операции или състояния."}}
    ]
  }
  </script>

  <!-- LCP preload за главното изображение (без да влияе на сайдбара) -->
  <link rel="preload" as="image"
        href="../pngs/procedures/function.webp"
        imagesrcset="../pngs/procedures/function-320.webp 320w, ../pngs/procedures/function-480.webp 480w, ../pngs/procedures/function-640.webp 640w"
        imagesizes="(max-width: 480px) 90vw, (max-width: 768px) 60vw, 640px"
        fetchpriority="high">
</head>

<body>
<!-- ======= Top bar ======= -->
<header class="tb-header" role="banner">
  <div class="tb-inner">
    <a href="/index.html" class="tb-logo-link" aria-label="Начало">
      <img src="/logo.webp" alt="ДМ Физио Лого" class="tb-logo"
           width="64" height="64" decoding="async" loading="eager" fetchpriority="high" />
    </a>

    <button class="tb-burger" aria-controls="tb-primary-nav" aria-expanded="false" aria-label="Отвори меню">
      <svg class="tb-burger-icon" viewBox="0 0 24 24" width="28" height="28" aria-hidden="true" focusable="false">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <nav class="tb-nav" id="tb-primary-nav" aria-label="Основна навигация">
      <ul class="tb-menu">
        <li class="tb-item"><a class="tb-link" href="/index.html">Начало</a></li>
        <li class="tb-item tb-dropdown">
          <a class="tb-link tb-drop-toggle" href="/services.html" data-dropdown="toggle">Процедури</a>
          <div class="tb-drop-menu">
            <a class="tb-drop-link" href="/kinesitherapy.html">Кинезитерапия</a>
            <a class="tb-drop-link" href="/massages.html">Масажи</a>
          </div>
        </li>
        <li class="tb-item"><a class="tb-link" href="/pain-conditions.html">Болкови състояния</a></li>
        <li class="tb-item"><a class="tb-link" href="https://book.dmphysi0.com/book">Свободни часове</a></li>
        <li class="tb-item"><a class="tb-link is-active" href="/contacts.html">Контакти</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="page-content">
  <!-- HERO/Интро -->
  <section class="procedure-journey section-green">
    <div class="container">
      <h2>Терапия със Сухи Игли</h2>
      <h3>стъпка по стъпка</h3>
      <p class="procedure-preamble">
        Терапията със сухи игли е съвременна техника за бързо намаляване на мускулна болка и освобождаване на тригерни точки. Чрез въвеждане на много тънки игли в специфични мускулни зони се предизвиква локален терапевтичен отговор, който отпуска тъканите, подобрява кръвоснабдяването и ускорява възстановяването.
      </p>

      <div class="journey-steps-wrapper">
        <!-- Етап 1 -->
        <article class="journey-step left-aligned">
          <figure class="journey-image image-container" tabindex="0" aria-label="Функционална оценка и изследване">
            <img src="../pngs/procedures/function.webp"
                 alt="Функционална оценка и изследване"
                 class="static-img"
                 decoding="async" loading="eager" fetchpriority="high"
                 width="640" height="640">
            <video class="hover-img" playsinline muted loop preload="metadata"
                   poster="../pngs/procedures/function.webp" aria-hidden="true"
                   width="640" height="640">
              <source src="../pngs/procedures/gif/funciton.mp4" type="video/mp4">
            </video>
          </figure>
          <div class="journey-content">
            <span class="step-label">Етап 1</span>
            <h3><span class="step-duration">(10 мин.)</span></h3>
            <h3>Функционална Оценка</h3>
            <p>
              Стартираме с прецизна оценка на стойка, обем на движение и мускулни дисбаланси, за да таргетираме правилните структури и да постигнем максимален ефект от терапията.
            </p>
            <ul class="step-highlights">
              <li><span class="check"></span> Индивидуална оценка на състоянието</li>
              <li><span class="check"></span> Идентифициране на дисбаланси</li>
              <li><span class="check"></span> Ясна стратегия за възстановяване</li>
            </ul>
            <p class="learn-more-link-container">
              <a href="functional-assessment.html" class="learn-more-link">Научи повече</a>
            </p>
          </div>
        </article>

        <!-- Етап 2 -->
        <article class="journey-step right-aligned">
          <figure class="journey-image image-container" tabindex="0" aria-label="Апликация със сухи игли">
            <img src="../pngs/procedures/dry-needling.webp"
                 alt="Апликация със сухи игли"
                 class="static-img"
                 decoding="async" loading="lazy"
                 width="640" height="640">
            <video class="hover-img" playsinline muted loop preload="metadata"
                   poster="../pngs/procedures/dry-needling.webp" aria-hidden="true"
                   width="640" height="640">
              <source src="../pngs/procedures/gif/drineedling.mp4" type="video/mp4">
            </video>
          </figure>
          <div class="journey-content">
            <span class="step-label">Етап 2</span>
            <h3><span class="step-duration">(20–30 мин.)</span></h3>
            <h3>Апликация със Сухи Игли</h3>
            <p>
              Сухото иглоубождане (dry needling) използва тънки, стерилни игли за еднократна употреба, които се въвеждат в пренапрегнати мускулни ленти и тригерни точки. Иглата предизвиква кратък „локален потрепващ отговор“, който ресетира мускулното влакно, понижава чувствителността на болковите рецептори и нормализира тонуса.
            </p>
            <ul class="step-highlights">
              <li><span class="check"></span> Стерилни игли за еднократна употреба</li>
              <li><span class="check"></span> Бързо редуциране на болката</li>
              <li><span class="check"></span> Подобряване на локалната циркулация</li>
            </ul>

            <h4>Как действа</h4>
            <p>
              Механизмът е двоен – локален и неврофизиологичен. Локално се подобрява микроциркулацията и се редуцира спазъмът в засегнатия сегмент. Неврофизиологично се модулира болковият сигнал и се нормализира мускулната активация в шаблона на движение.
            </p>
          </div>
        </article>
      </div>
    </div>

    <div class="container text-center">
      <p class="procedure-price">Цена: 60 лв.</p>
      <a href="https://book.dmphysi0.com/book" class="book-button large-button" rel="noopener">
        Запази час
      </a>
    </div>

    <!-- FAQ (native <details>) -->
    <section class="details-accordion section-light-grey" aria-labelledby="faq-title">
      <div class="container">
        <h2 id="faq-title">Често задавани въпроси</h2>

        <details class="accordion-details" id="faq1">
          <summary class="accordion-header">За кого е подходяща тази процедура?</summary>
          <div class="accordion-panel">
            <ul>
              <li>Остра и хронична болка в гърба, врата, раменете, коленете и други стави</li>
              <li>Възстановяване след спортни травми и операции</li>
              <li>Мускулни дисбаланси и постурални нарушения (лоша стойка)</li>
              <li>Изтръпвания, парези и други неврологични симптоми</li>
              <li>Главоболие от напрежение във врата и раменете</li>
              <li>Намалена ставна подвижност и скованост</li>
              <li>Превенция на травми и подобряване на форма</li>
            </ul>
          </div>
        </details>

        <details class="accordion-details" id="faq2">
          <summary class="accordion-header">Колко често трябва да посещавам процедурата?</summary>
          <div class="accordion-panel">
            <p>Обичайно започваме с 1–2 сесии седмично, след което намаляваме според напредъка. Планираме индивидуално.</p>
          </div>
        </details>

        <details class="accordion-details" id="faq3">
          <summary class="accordion-header">Необходима ли е подготовка?</summary>
          <div class="accordion-panel">
            <p>Носете удобно облекло, което позволява свободно движение. Споделете предишни травми, операции или състояния.</p>
          </div>
        </details>
      </div>
    </section>
  </section>

  <!-- Сайдбар (динамично съдържание) -->
  <aside id="random-conditions" class="sidebar-conditions" aria-label="Болкови състояния">
    <h3>Болкови състояния</h3>
    <div class="pain-buttons-grid" id="conditions-container"></div>
  </aside>
</main>

<footer class="footer">
  <section class="contact-section" aria-label="Контакти">
    <div class="contact-container">
      <div class="contact-left">
        <div class="map" aria-label="Локация на DM Physio в Google Maps">
          <iframe id="mapFrame"
            data-src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d1467.1224362949854!2d23.344392!3d42.656166!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40aa85f99bb08d7d%3A0x97edb5ec1f8fa66d!2zRE0gUEhZU0lPLyDQlNCcINCk0JjQl9CY0J4g0KHRgtGD0LTQuNC-INC30LAg0LvQtdGH0LXQsdC90Lgg0LzQsNGB0LDQttC4INC4INC60LjQvdC10LfQuNGC0LXRgNCw0L_QuNGP!5e0!3m2!1sbg!2sbg!4v1758308144619!5m2!1sbg!2sbg"
            width="300" height="250" style="border:0;" allowfullscreen loading="lazy"
            referrerpolicy="no-referrer-when-downgrade" title="DM Physio – локация София"></iframe>
        </div>
      </div>

      <div class="contact-center">
        <h2>Свържете се с нас:</h2>
        <div class="social-links" aria-label="Социални мрежи">
          <a href="https://www.facebook.com/dmphysio03" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
            <img src="/pngs/social/facebook.png" alt="Facebook" width="32" height="32"
                 loading="lazy" decoding="async" fetchpriority="low">
          </a>
          <a href="https://www.instagram.com/dm.physio/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
            <img src="/pngs/social/instagram.png" alt="Instagram" width="32" height="32"
                 loading="lazy" decoding="async" fetchpriority="low">
          </a>
          <a href="https://www.youtube.com/@dmphysio3352" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
            <img src="/pngs/social/Youtube.png" alt="YouTube" width="32" height="32"
                 loading="lazy" decoding="async" fetchpriority="low">
          </a>
          <a href="https://www.tiktok.com/@dmphysio" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
            <img src="/pngs/social/tiktok.png" alt="TikTok" width="32" height="32"
                 loading="lazy" decoding="async" fetchpriority="low">
          </a>
        </div>
      </div>

      <div class="contact-right">
        <div class="contact-item phone">
          <img src="/pngs/social/phone.png" alt="" class="icon"
               width="24" height="24" loading="lazy" decoding="async" fetchpriority="low" aria-hidden="true">
          <span><a href="tel:0883688414">0883688414</a></span>
        </div>

        <div class="contact-item work-hours">
          <img src="/pngs/clock.avif" alt="" class="icon"
               width="24" height="24" loading="lazy" decoding="async" fetchpriority="low" aria-hidden="true">
          <div>
            <span>Работно време:</span><br>
            <span>Пон–Пет: 09:00 – 19:00</span><br>
            <span>Събота: 09:00 – 16:00</span><br>
            <span>Неделя: Почивка</span>
          </div>
        </div>

        <div class="contact-item address-item">
          <img src="/pngs/social/location.png" alt="" class="icon"
               width="24" height="24" loading="lazy" decoding="async" fetchpriority="low" aria-hidden="true">
          <div>
            <span>София, ул. „Проф. Христо Данов“ 19</span><br>
            <a href="https://maps.app.goo.gl/QsERnvvAdoY1nRXp6?g_st=ipc" target="_blank" rel="noopener noreferrer" class="map-link">
              Вижте на карта →
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-links">
      <a href="/privacy-policy.html">Политика за поверителност</a> | <a href="/terms.html">Общи условия</a>
    </div>
  </section>
</footer>

<!-- Скриптове (неблокиращи) -->
<script src="/js/topbar.js" defer></script>

<!-- ВИДЕО hover: play/pause с guards -->
<script>
"use strict";
document.addEventListener("DOMContentLoaded", function () {
  try {
    var videos = document.querySelectorAll("video.hover-img");
    if (!videos.length) return;
    videos.forEach(function (v) {
      try {
        v.preload = "metadata";
        v.muted = true;
        v.defaultMuted = true;
        v.setAttribute("muted", "");
        v.playsInline = true;
        v.setAttribute("playsinline", "");
        v.setAttribute("webkit-playsinline", "");
        v.controls = false;
        v.setAttribute("disablepictureinpicture", "");
        v.setAttribute("controlslist", "nodownload nofullscreen noremoteplayback");

        v.addEventListener("mouseenter", function () {
          v.play && v.play().catch(function () {});
        }, { passive: true });

        v.addEventListener("mouseleave", function () {
          try { v.pause && v.pause(); v.currentTime = 0; } catch (_) {}
        }, { passive: true });
      } catch (_) {}
    });
  } catch (_) {}
});
</script>

<!-- Сайдбар: зареждане на conditions.html + инициализация на медии (safe/без логове в продукция) -->
<script>
"use strict";
(function () {
  var IS_DEV = (function () {
    try { return location.hostname === "localhost" || location.hostname === "127.0.0.1"; }
    catch (_) { return false; }
  })();

  var KEY = "conditions_html_v3";
  var MAX_ITEMS = 6;
  var SRC_PAGE = "/conditions.html?v=3";

  function devWarn() {
    if (!IS_DEV) return;
    try { console.warn.apply(console, arguments); } catch (_) {}
  }

  function xmur3(str) {
    var h = 1779033703 ^ str.length;
    for (var i = 0; i < str.length; i++) {
      h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
      h = (h << 13) | (h >>> 19);
    }
    return function () {
      h = Math.imul(h ^ (h >>> 16), 2246822507);
      h = Math.imul(h ^ (h >>> 13), 3266489909);
      return (h ^ (h >>> 16)) >>> 0;
    };
  }
  function mulberry32(a) {
    return function () {
      var t = a += 0x6D2B79F5;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }
  function shuffleWithRNG(arr, rng) {
    var a = arr.slice();
    for (var i = a.length - 1; i > 0; i--) {
      var j = Math.floor(rng() * (i + 1));
      var t = a[i]; a[i] = a[j]; a[j] = t;
    }
    return a;
  }

  function absolutize(el, attr) {
    try {
      var val = el.getAttribute(attr);
      if (!val) return;
      if (/^([a-z]+:)?\/\//i.test(val) || val.startsWith("/")) return;
      el.setAttribute(attr, "/" + val.replace(/^\.?\//, ""));
    } catch (_) {}
  }

  function selectVaried(html) {
    try {
      var temp = document.createElement("div");
      temp.innerHTML = html;

      // само MP4
      temp.querySelectorAll("video source").forEach(function (s) {
        var src = (s.getAttribute("src") || "").toLowerCase();
        var type = (s.getAttribute("type") || "").toLowerCase();
        if (type.includes("webm") || src.endsWith(".webm") || /\/gifs?\//.test(src) || src.endsWith(".gif")) {
          s.remove();
        }
      });

      temp.querySelectorAll("video").forEach(function (v) {
        if (!v.querySelector('source[type="video/mp4"]')) { v.remove(); return; }
        v.removeAttribute("autoplay");
        v.setAttribute("preload", "metadata");
        v.setAttribute("playsinline", "");
        v.classList.add("hover-img");
      });

      temp.querySelectorAll("img").forEach(function (img) {
        absolutize(img, "src");
        img.loading = "lazy";
        img.decoding = "async";
        if (!img.classList.contains("static-img")) img.classList.add("static-img");
        if (!img.getAttribute("width")) img.setAttribute("width", "352");
        if (!img.getAttribute("height")) img.setAttribute("height", "352");
      });

      temp.querySelectorAll("video").forEach(function (v) { absolutize(v, "poster"); });
      temp.querySelectorAll("video source").forEach(function (s) { absolutize(s, "src"); });
      temp.querySelectorAll("a").forEach(function (a) { absolutize(a, "href"); });
      temp.querySelectorAll(".pc-card").forEach(function (card) { card.classList.add("pain-button-media"); });

      var all = Array.prototype.slice.call(temp.querySelectorAll(".pain-button"));
      if (!all.length) return [];

      var d = new Date();
      var seedStr = d.getFullYear() + "-" + String(d.getMonth() + 1).padStart(2, "0") + "-" + String(d.getDate()).padStart(2, "0") + "|" + (location.pathname || "/");
      var rng = mulberry32(xmur3(seedStr)());
      var picked = shuffleWithRNG(all, rng).slice(0, MAX_ITEMS);

      picked.forEach(function (el) {
        el.querySelectorAll("img").forEach(function (img) {
          if (!img.width && !img.height) { img.width = 352; img.height = 352; }
        });
      });
      return picked;
    } catch (_) { return []; }
  }

  function initSidebarMedia(root) {
    try {
      var IS_TOUCH = (typeof matchMedia === "function" && matchMedia("(hover:none) and (pointer:coarse)").matches);
      var boxes = root.querySelectorAll(".image-container, .pain-button-media");
      if (!boxes.length) return;

      boxes.forEach(function (box) {
        try {
          var img = box.querySelector(".static-img");
          var vid = box.querySelector("video.hover-img");
          if (!img || !vid) return;

          vid.muted = true; vid.defaultMuted = true; vid.setAttribute("muted", "");
          vid.playsInline = true; vid.setAttribute("playsinline", ""); vid.setAttribute("webkit-playsinline", "");
          vid.preload = "metadata"; vid.controls = false;
          vid.setAttribute("disablepictureinpicture", "");
          vid.setAttribute("controlslist", "nodownload nofullscreen noremoteplayback");

          var s = vid.querySelector("source");
          if (s && !vid.src) { try { vid.src = s.src; } catch (_) {} }

          var cs = getComputedStyle(box);
          if (cs.position === "static") box.style.position = "relative";
          if (cs.overflow === "visible") box.style.overflow = "hidden";

          function show() { vid.play && vid.play().catch(function () {}); }
          function hide() { try { vid.pause && vid.pause(); vid.currentTime = 0; } catch (_) {} }

          if (!IS_TOUCH) {
            box.addEventListener("mouseenter", show, { passive: true });
            box.addEventListener("mouseleave", hide, { passive: true });
          }

          if ("IntersectionObserver" in window) {
            var thr = IS_TOUCH ? 0.5 : 0.1;
            var io = new IntersectionObserver(function (ents) {
              ents.forEach(function (en) {
                if (en.isIntersecting && en.intersectionRatio >= thr) { if (IS_TOUCH) show(); }
                else { hide(); }
              });
            }, { rootMargin: "200px 0px", threshold: [0, 0.1, 0.5, 1] });
            io.observe(box);
          }
        } catch (_) {}
      });
    } catch (_) {}
  }

  function inject(elements) {
    try {
      var container = document.getElementById("conditions-container");
      if (!container || !elements || !elements.length) return;
      elements.forEach(function (el) { container.appendChild(el); });
      initSidebarMedia(container);
    } catch (_) {}
  }

  function safeGetSession(key) {
    try { return sessionStorage.getItem(key); } catch (_) { return null; }
  }
  function safeSetSession(key, val) {
    try { sessionStorage.setItem(key, val); } catch (_) {}
  }

  async function fetchAndCache() {
    try {
      var res = await fetch(SRC_PAGE, { credentials: "same-origin", cache: "no-store" });
      if (!res || !res.ok) return "";
      var text = await res.text();
      safeSetSession(KEY, text);
      return text;
    } catch (_) { return ""; }
  }

  function onVisible(el, cb) {
    try {
      if (!("IntersectionObserver" in window)) { cb(); return; }
      var io = new IntersectionObserver(function (entries) {
        entries.forEach(function (en) {
          if (en.isIntersecting) { try { io.disconnect(); } catch (_) {} cb(); }
        });
      }, { rootMargin: "200px 0px" });
      io.observe(el);
    } catch (_) { cb(); }
  }

  document.addEventListener("DOMContentLoaded", function () {
    try {
      var target = document.getElementById("random-conditions");
      if (!target) return;

      onVisible(target, async function () {
        try {
          var cached = safeGetSession(KEY);
          var html = cached || (await fetchAndCache());
          if (html) inject(selectVaried(html));
        } catch (e) { devWarn("conditions.html error:", e); }
      });
    } catch (_) {}
  });
})();
</script>

<!-- Lazy load за картата -->
<script>
"use strict";
(function () {
  try {
    var iframe = document.getElementById("mapFrame");
    if (!iframe) return;
    var dataSrc = iframe.getAttribute("data-src");
    if (!dataSrc) return;

    if (!("IntersectionObserver" in window)) {
      if (!iframe.src) iframe.src = dataSrc;
      return;
    }
    var io = new IntersectionObserver(function(entries){
      if (entries.some(function(e){ return e.isIntersecting; })){
        if (!iframe.src) iframe.src = dataSrc;
        try { io.disconnect(); } catch (_) {}
      }
    }, { rootMargin: "300px" });
    io.observe(iframe);
  } catch (_) {}
})();
</script>

<script src="/js/media-autoplay-cards.js" defer></script>
</body>
</html>
